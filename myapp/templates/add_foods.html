{% comment %} {% extends 'base/admin_base.html' %}

{% block content %}
<main class="container mx-auto p-4">
    <h1 class="text-2xl font-semibold mb-4">Menu Items</h1>

    <!-- Add Item Button -->
    <button onclick="openModal()" class="mb-4 bg-green-500 text-white px-4 py-2 rounded">
        Add New Item
    </button>

    <!-- Menu List -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for item in menu_items %}
        <div class="bg-white p-4 rounded shadow">
            {% if item.image %}
                <img src="{{ item.image.url }}" class="w-full h-40 object-cover rounded">
            {% endif %}
            <h2 class="text-lg font-semibold">{{ item.name }}</h2>
            <p class="text-gray-600">{{ item.description }}</p>
            <p class="text-xl font-bold text-green-600">${{ item.price }}</p>
            <p class="text-sm text-gray-500">{{ item.category.name }}</p>
            <p class="text-sm font-medium {% if item.available %}text-green-500{% else %}text-red-500{% endif %}">
                {% if item.available %} Available {% else %} Not Available {% endif %}
            </p>
        </div>
        {% endfor %}
    </div>

    <!-- Add Item Modal -->
    <div id="addItemModal" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded shadow w-96">
            <h2 class="text-xl font-semibold mb-4">Add New Menu Item</h2>
            <form id="addItemForm" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Add Item</button>
                <button type="button" onclick="closeModal()" class="ml-2 bg-gray-400 text-white px-4 py-2 rounded">Cancel</button>
            </form>
        </div>
    </div>
</main>

<!-- JavaScript -->
<script>
    function openModal() {
        document.getElementById("addItemModal").classList.remove("hidden");
    }

    function closeModal() {
        document.getElementById("addItemModal").classList.add("hidden");
    }

    document.getElementById("addItemForm").addEventListener("submit", function (event) {
        event.preventDefault();
        let formData = new FormData(this);

        fetch("{% url 'add_menu_item' %}", {
            method: "POST",
            body: formData,
            headers: {
                "X-Requested-With": "XMLHttpRequest"
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Item added successfully!");
                closeModal();
                location.reload(); // Refresh menu list
            } else {
                alert("Error adding item.");
            }
        })
        .catch(error => console.error("Error:", error));
    });
</script>

{% endblock %} {% endcomment %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Menu Item</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gray-100 p-6">

    <!-- Add Item Button -->
    <button onclick="openModal()" class="bg-green-500 text-white px-4 py-2 rounded">
        Add New Item
    </button>

    <!-- Add Item Modal -->
    <div id="addItemModal" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded shadow w-96">
            <h2 class="text-xl font-semibold mb-4">Add New Menu Item</h2>

            <form id="addItemForm" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p }}

                <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Add Item</button>
                <button type="button" onclick="closeModal()" class="ml-2 bg-gray-400 text-white px-4 py-2 rounded">Cancel</button>
            </form>

            <div id="formErrors" class="text-red-500 mt-2 hidden"></div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        function openModal() {
            document.getElementById("addItemModal").classList.remove("hidden");
        }

        function closeModal() {
            document.getElementById("addItemModal").classList.add("hidden");
        }

        // AJAX Form Submission
        $(document).ready(function () {
            $("#addItemForm").submit(function (event) {
                event.preventDefault();  // Prevent full page reload

                var formData = new FormData(this);

                $.ajax({
                    type: "POST",
                    url: "{% url 'add_menu_item' %}",  // Django view URL
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        alert(response.message);
                        closeModal();
                        location.reload();  // Refresh to see the new item
                    },
                    error: function (xhr) {
                        var errors = JSON.parse(xhr.responseText).errors;
                        var errorMessages = "";

                        for (var key in errors) {
                            errorMessages += errors[key] + "<br>";
                        }

                        $("#formErrors").html(errorMessages).removeClass("hidden");
                    }
                });
            });
        });
    </script>

</body>
</html>
